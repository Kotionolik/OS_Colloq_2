# Коллоквиум 2

Этот проект демонстрирует работу с многопоточностью в C++ с использованием паттерна Singleton для управления общими данными. Приложение позволяет пользователю задать размер массива и количество потоков, которые будут последовательно вычислять среднее значение массива и модифицировать его элементы.

## Особенности проекта

- Реализация потокобезопасного Singleton с различными политиками
- Синхронизация потоков с использованием мьютексов и условных переменных
- Динамическое управление потоками (запуск и завершение)
- Модульные тесты с использованием Google Test

## Сборка проекта

### Требования
- Компилятор C++ с поддержкой C++17
- CMake (версия 3.15 или выше)
- Google Test (устанавливается через vcpkg)

### Инструкция по сборке

1. Клонировать репозиторий:
   ```
   git clone https://github.com/yourusername/threaded-array-modifier.git
   cd threaded-array-modifier
   ```

2. Создать директорию для сборки:
   ```
   mkdir build
   cd build
   ```

3. Запустить CMake:
   ```
   cmake ..
   ```

4. Собрать проект:
   ```
   cmake --build .
   ```

## Запуск приложения

После сборки в директории `build` будут созданы два исполняемых файла:

1. **Основное приложение**:
   ```
   ./Main
   ```

2. **Тесты**:
   ```
   ./Tests
   ```

## Использование программы

1. При запуске `Main` программа запросит:
   - Размер массива (n) - положительное целое число
   - Количество потоков (k) - неотрицательное целое число

2. Программа отобразит начальное состояние массива

3. Потоки начинают работу, вычисляя среднее значение массива и записывая его в свой элемент (определяемый как `id % n`)

4. После каждого цикла выполнения:
   - Выводится текущее состояние массива
   - Пользователь выбирает поток для завершения (по ID)
   - Выбранный поток корректно завершает работу

5. Процесс повторяется, пока все потоки не будут завершены

6. В конце программа выводит финальное состояние массива

## Пример работы

```
Enter array size (n): 3
Enter number of threads (k): 2

Initial array: 1 2 3 

Thread 0 terminated. Resulting array:
2.33333 2 3 

Thread 1 terminated. Resulting array:
2.33333 2.33333 3 

Current array: 2.33333 2.33333 3 
Enter thread ID to terminate (0-1): 0
Thread 0 completed.

... продолжение работы ...
```

## Тестирование

Проект включает модульные тесты, проверяющие:
- Корректность работы Singleton
- Инициализацию данных
- Логику вычислений
- Синхронизацию потоков
- Механизм завершения потоков

Для запуска тестов выполните:
```
./Tests
```

## Особенности реализации

1. **Потокобезопасный Singleton**:
   - Использует атомарные операции для безопасного создания экземпляра
   - Поддерживает различные политики создания и времени жизни
   - Обеспечивает безопасность в многопоточной среде

2. **Механизм синхронизации**:
   - Использует три условные переменные для координации потоков
   - `cv_start` - запуск всех потоков одновременно
   - `cv_all_done` - ожидание завершения цикла всех потоков
   - `cv_decision` - управление завершением потоков

3. **Динамическое управление потоками**:
   - Возможность поочередного завершения потоков
   - Контроль состояния через флаги завершения
   - Автоматическое уменьшение количества активных потоков
